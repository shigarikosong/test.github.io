<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã—ãŒã‚Šsã“ã®ã†ãŸã€‚ï½œå¸è³€ã‚Šã“éå…¬å¼ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆ</title>
  <link rel="icon" type="image/svg+xml" href="/icon.svg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", sans-serif;
    }
    .fade-in {
      animation: fadeIn 0.4s ease-out both;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

/* ãƒªã‚¹ãƒˆé …ç›®ã®ã‚¹ã‚¿ã‚¤ãƒ« */
#videoList div {
  background-color: #e0f7fa;
  border-radius: 8px;
}


.meta-row {
  display: flex;
  flex-wrap: wrap; /* å¿µã®ãŸã‚ */
  gap: 8px;
  margin-top: 2px;
  line-height: 1.4;
  white-space: nowrap; /* ã“ã‚Œã§1è¡Œã«æƒãˆã‚„ã™ããªã‚‹ */
}

.meta-label {
  font-weight: 600;
  margin-right: 2px;
  color: #374151; /* ãƒ€ãƒ¼ã‚¯ã‚°ãƒ¬ãƒ¼ */
}

.meta-value {
  margin-right: 16px;
}

.video-item-row {
  display: flex;
  flex-wrap: nowrap;
  gap: 0.5rem;
  align-items: center;
  overflow-x: auto;
  white-space: nowrap;
  min-width: 0
}

.video-title {
  flex: 3;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: left;
  font-weight: 600;
  color: #1e40af;
}


.video-artist {
  flex: 2;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: #374151;
}


.video-meta {
  display: flex;
  flex-wrap: nowrap;
  gap: 1rem;
  font-size: 0.875rem;
  color: #4b5563; /* text-gray-600 */
  overflow: hidden;
  white-space: nowrap;
}



#videoList a:hover {
  text-decoration: underline;  /* ãƒ›ãƒãƒ¼æ™‚ã«ä¸‹ç·šã‚’è¿½åŠ  */
}

    #videoList .playing {
  background-color: #fffbe6; /* æ·¡ã„é»„è‰²ã«å¤‰æ›´ */
  border-left: 4px solid #facc15; /* é»„è‰²ã®ãƒ©ã‚¤ãƒ³è¿½åŠ  */
}

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å›ºå®š */
header {
  position: static; /* â† è¿½åŠ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã™ï¼‰ */
  background-color: white;
}

/* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ã‚’å›ºå®š */
section {
  position: sticky;
  top: 0px; 
  z-index: 20;  /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚ˆã‚Šä¸‹ã«é…ç½® */
  background-color: white;
  padding-top: 10px;
  padding-bottom: 10px;
}

      /* å›ºå®šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”¨ã®CSS */
  #fixedPlayer {
    display: none; /* æœ€åˆã¯éè¡¨ç¤º */
    bottom: 0px;  /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é«˜ã• + ä½™ç™½åˆ†ã ã‘ä¸Šã«é…ç½® */
  }

    #fixedPlayer .controls-wrapper {
  padding-bottom: 8px; /* â† å¿…è¦ã«å¿œã˜ã¦å¢—ã‚„ã—ã¦èª¿æ•´ */
}

    #fixedPlayer iframe {
  display: block;
  max-height: 80vh;
  margin: 0 auto;
}

    #fixedPlayer {
  padding-bottom: 0 !important;
}

#fixedPlayer iframe {
  margin-bottom: 0 !important;
  display: block;
}

    /* ã‚µã‚¤ã‚ºåˆ‡æ›¿ï¼ˆç¸®å°ï¼‰æ™‚ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å·¦å¯„ã›ï¼†å³ä½™ç™½ã‚¼ãƒ­ã«ã™ã‚‹ */
#fixedPlayer.player-small {
  justify-content: start; /* å·¦å¯„ã› */
  padding-left: 0;
  padding-right: 0;
}

#fixedPlayer.player-small #playerContainer {
  margin-left: 0;
  margin-right: auto;
  max-width: 640px; /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æœ€å¤§å¹… */
}

#fixedPlayer.player-small iframe {
  display: block;
  margin: 0;
  width: 100%;
  height: auto;
}

    /* ç¸®å°æ™‚ã€ãƒœã‚¿ãƒ³ã‚’å·¦ä¸Šã«å¯„ã›ã‚‹ */
#fixedPlayer.player-small #closePlayerBtn {
  right: auto;
  left: 0.5rem;
}

#fixedPlayer.player-small [onclick="togglePlayerSize()"] {
  right: auto;
  left: 0.5rem;
  top: 3rem; /* âœ–ãƒœã‚¿ãƒ³ã¨ã®é‡ãªã‚Šã‚’é¿ã‘ã‚‹ */
}



#nowPlayingWrapper {
  background-color: #e0f2fe;
  box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
  height: auto; /* é«˜ã•ã‚’å›ºå®šå€¤ã‹ã‚‰è‡ªå‹•ã« */
  padding-top: 4px;
  padding-bottom: 8px; /* ãƒœã‚¿ãƒ³ã«ä½™è£•ã‚’æŒãŸã›ã‚‹ */
}
#videoList .playing {
  background-color: #fffbe6; /* ãƒã‚¤ãƒ©ã‚¤ãƒˆè‰² */
  border-left: 4px solid #facc15; /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆãƒ©ã‚¤ãƒ³ */
}

#videoWrapper {
  background-color: black;
  border-radius: 0.75rem; /* rounded-xl */
  box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1); /* shadow-lg */
  width: 100%;
  height: auto;
  position: relative;
}

#fixedPlayer.player-small #playerControls {
  justify-content: flex-start; /* å·¦å¯„ã› */
  padding-left: 1rem;          /* å·¦ã«ä½™ç™½ã‚’å°‘ã—ã¤ã‘ã‚‹ï¼ˆèª¿æ•´å¯ï¼‰ */
  padding-right: 0;            /* å³ã®ä½™ç™½ã‚’ãªãã™ */
}

  </style>
</head>
<body style="background-color: #FFE36C;" class="text-gray-800">
  <header class="relative border-b z-10 bg-white/90 backdrop-blur px-4 py-3 shadow-sm">
  <h1 class="text-left text-xl sm:text-2xl font-semibold text-gray-900 tracking-tight">
  ã—ãŒã‚Šã“ã®ã†ãŸã€‚<br class="sm:hidden"><span class="text-sm sm:text-base">ï½œå¸è³€ã‚Šã“éå…¬å¼ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆ
</h1>

  <div class="absolute right-4 top-1/2 -translate-y-1/2 flex space-x-4 items-center">
    <a href="https://www.youtube.com/@ShigaRiko" target="_blank" aria-label="YouTube">
      <img src="./YT_icon.svg" alt="YouTube" class="w-8 h-8" />
    </a>
    <a href="https://www.tiktok.com/@riko14218" target="_blank" aria-label="TikTok">
      <img src="./TT_icon.svg" alt="TikTok" class="w-8 h-8" />
    </a>
    <a href="https://x.com/Shigariko_" target="_blank" aria-label="X">
      <img src="./X_icon.svg" alt="X" class="w-8 h-8" />
    </a>
  </div>
</header>

  <div class="max-w-4xl mx-auto px-4 mt-4 text-center text-sm text-gray-600">
  ã«ã˜ã•ã‚“ã˜æ‰€å± å¸sè³€ã‚Šã“ã•ã‚“ã®æ­Œã£ã¦ã¿ãŸã‚„æ­Œæ ãªã©ã‚’ã¾ã¨ã‚ãŸéå…¬å¼ãƒ•ã‚¡ãƒ³ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚<br>
  Youtube(æ­Œã£ã¦ã¿ãŸã€shortsã€æ­Œæ ) / tiktok ã‚’æ²è¼‰ã—ã¦ã„ã¾ã™ã€‚<br>
  tiktokã®ã¿ã€ä»•æ§˜ä¸Šyoutubeã«æ¯”ã¹ã‚‹ã¨å†ç”ŸéŸ³ãŒå¤§ãã„ç‚ºã€ã”æ³¨æ„ãã ã•ã„ã€‚<br>
</div>

  <section class="max-w-8xl mx-auto mt-6 mb-6 px-4">

<!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼šçµã‚Šè¾¼ã¿ï¼‹ãƒ©ãƒ³ãƒ€ãƒ å†ç”Ÿã‚’æ¨ªä¸¦ã³ -->
<div class="flex sm:hidden items-center justify-center gap-2 mt-4 px-4">
  <button id="openFilterModal" class="bg-blue-500 text-white px-4 py-2 rounded-md w-full">
    ğŸ” çµã‚Šè¾¼ã¿
  </button>
  <button id="mobileRandomPlayButton" class="bg-green-500 text-white px-4 py-2 rounded-md w-full">
    ğŸ² ãƒ©ãƒ³ãƒ€ãƒ å†ç”Ÿ
  </button>
</div>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3">
      <select id="categoryFilter" class="hidden sm:block rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
        <option value="">ã‚«ãƒ†ã‚´ãƒª</option>
      </select>
      <select id="dateFilter" class="hidden sm:block rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
        <option value="">å…¬é–‹æ—¥</option>
      </select>
      <select id="typeFilter" class="hidden sm:block rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
        <option value="">å‹•ç”»ç¨®åˆ¥</option>
      </select>
      <select id="roleFilter" class="hidden sm:block rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
        <option value="">æ‹…å½“åŒºåˆ†</option>
      </select>
      <input id="searchInput" type="text" placeholder="æ›²åãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ" 
        class="hidden sm:block col-span-1 sm:col-span-2 rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
<select id="sortOrder" class="hidden sm:block rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-blue-300 transition duration-200">
  <option value="desc">æ–°ã—ã„é †</option>
  <option value="asc">å¤ã„é †</option>
  <option value="title">æ›²åé †</option>
  <option value="artist">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆé †</option>
</select>
      <button id="resetFilters" class="hidden sm:block bg-blue-100 hover:bg-blue-200 text-blue-900 font-medium text-sm px-4 py-2 rounded-md transition-all duration-300">ãƒªã‚»ãƒƒãƒˆ</button>
          <!-- ãƒ©ãƒ³ãƒ€ãƒ å†ç”Ÿãƒœã‚¿ãƒ³ -->
<button id="randomPlayButton" class="hidden sm:block bg-green-100 hover:bg-green-200 text-green-900 font-medium text-sm px-4 py-2 rounded-md transition-all duration-300">
  ãƒ©ãƒ³ãƒ€ãƒ å†ç”Ÿ
</button>
    </div>
  </section>

  <div id="songCount" class="text-center text-sm text-gray-700 mb-4">
  <!-- ä»¶æ•°ã¯JSã§åŸ‹ã‚è¾¼ã¿ -->
</div>


  <main id="videoList" class="max-w-4xl mx-auto px-4 py-8 divide-y divide-gray-200"> 
  </main>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬ä½“ -->
<div id="filterModal" class="fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center hidden">
  <div class="bg-white w-11/12 max-w-md p-4 rounded-lg shadow-lg">
    <h2 class="text-lg font-bold mb-4">çµã‚Šè¾¼ã¿</h2>
    
    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å…¥åŠ›æ¬„ -->
    <div class="space-y-3">
        <select id="modalSortOrder" class="w-full border p-2 rounded">
    <option value="desc">æ–°ã—ã„é †</option>
    <option value="asc">å¤ã„é †</option>
    <option value="title">æ›²åé †</option>
    <option value="artist">ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆé †</option>
  </select>
      <select id="modalCategoryFilter" class="w-full border p-2 rounded">
        <option value="">ã‚«ãƒ†ã‚´ãƒª</option>
      </select>
      <select id="modalDateFilter" class="w-full border p-2 rounded">
        <option value="">å…¬é–‹æ—¥</option>
      </select>
      <select id="modalTypeFilter" class="w-full border p-2 rounded">
        <option value="">å‹•ç”»ç¨®åˆ¥</option>
      </select>
      <select id="modalRoleFilter" class="w-full border p-2 rounded">
        <option value="">æ‹…å½“åŒºåˆ†</option>
      </select>
      <input id="modalSearchInput" type="text" placeholder="æ›²åãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ" class="w-full border p-2 rounded" />
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œ -->
    <div class="mt-4 flex justify-between">
      <button id="applyFilters" class="bg-blue-500 text-white px-4 py-2 rounded-md">é©ç”¨</button>
      <button id="closeFilterModal" class="text-gray-600 hover:text-black px-4 py-2">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
  </div>
</div>


  <footer class="text-center text-xs text-gray-500 mt-12 px-4 pb-64 space-y-2">
  <p>æœ¬ã‚µã‚¤ãƒˆã¯ãƒ•ã‚¡ãƒ³ã«ã‚ˆã‚‹éå…¬å¼ãƒšãƒ¼ã‚¸ã§ã™ã€‚</p>
  <p>ã“ã®ã‚µã‚¤ãƒˆã¯ <a href="https://pages.github.com/" class="underline" target="_blank">GitHub Pages</a> ã‚’åˆ©ç”¨ã—ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚</p>
  <p>å‹•ç”»ã¯å„é…ä¿¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®åŸ‹ã‚è¾¼ã¿æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚</p>
    
 <p class="mt-6">åˆ¶ä½œã«ã‚ãŸã‚Šã€ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸï¼ˆæ•¬ç§°ç•¥ãƒ»é †ä¸åŒï¼‰ï¼š</p>
<ul class="list-disc list-inside text-left mx-auto max-w-md text-gray-500">
  <li><a href="https://chimauta.pages.dev/" class="underline" target="_blank">ã¡ã¾ã†ãŸï½œç”ºç”°ã¡ã¾éå…¬å¼ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆ</a></li>
  <li><a href="https://uta.inui-dondon-sukininaru.net/" class="underline" target="_blank">ã„ã¬ã„ã®ã†ãŸ | æˆŒäº¥ã¨ã“éå…¬å¼ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆ</a></li>
</ul>

<p class="mt-6">æ­Œæ ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚„æ›²æƒ…å ±ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§æ²è¼‰ã—ã¦ãã‚Œã¦ã„ã‚‹çš†ã•ã¾ã«æ„Ÿè¬ã€‚</p>

 <p>æœ€çµ‚æ›´æ–°æ—¥ï¼š2025/08/2</p>
</footer>
 
<!-- å†ç”Ÿä¸­ã®æ›²åã¨ãƒœã‚¿ãƒ³ã‚’ä¸€ã¤ã®ç®±ã«å…¥ã‚Œã‚‹ -->
<div id="nowPlayingWrapper" class="fixed bottom-0 left-0 w-full bg-blue-100 text-blue-900 z-30">
  <div id="nowPlaying" class="py-2 text-center font-medium">
    <span id="nowPlayingTitle">å†ç”Ÿä¸­</span>
  </div>
  
<div id="playerControls" class="flex justify-start gap-2 py-2 px-4">
  <button id="prevVideoBtn" ...>â—€ æˆ»ã‚‹</button>
  <button id="nextVideoBtn" ...>â–¶ æ¬¡ã¸</button>
  <button id="randomFromFilteredBtn" ...>ğŸ² ãƒ©ãƒ³ãƒ€ãƒ </button>
</div>


<div id="fixedPlayer" class="fixed bottom-0 left-0 w-full bg-white border-t shadow-lg z-20">
  <div id="playerContainer" class="bg-black rounded-xl shadow-lg inline-block w-fit" style="position: relative;">


    <!-- âœ–ãƒœã‚¿ãƒ³ -->
    <button id="closePlayerBtn" class="absolute top-0 right-0 p-2 text-gray-700 hover:text-blue-600 font-bold">
      âœ–
    </button>

    <!-- ã‚µã‚¤ã‚ºåˆ‡ã‚Šæ›¿ãˆ -->
    <button onclick="togglePlayerSize()" class="absolute top-10 right-0 p-1 text-sm bg-gray-200 hover:bg-gray-300 rounded shadow z-10">
      ã‚µã‚¤ã‚ºåˆ‡æ›¿
    </button>

<div id="videoWrapper" class="bg-black rounded-xl shadow-lg w-full h-auto" style="position: relative;">
  <iframe id="playerIframe" class="w-full h-auto"></iframe>
</div>

  </div>
</div>

<template id="videoPlayerTemplate">
  <div id="videoWrapper" class="bg-black rounded-xl shadow-lg inline-block w-fit h-fit" style="position: relative;">
    <iframe class="w-full h-auto" ...></iframe>
  </div>
  <div class="absolute bottom-2 right-2">
    <button onclick="togglePlayerSize()" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-sm rounded shadow">
      ã‚µã‚¤ã‚ºåˆ‡æ›¿
    </button>
  </div>
</template>

  
  <script>
    
    const sheetJsonUrl = 'https://opensheet.elk.sh/1sZGH3TGYdC5UShrIEFEe2T8-axXEFet6qsxbqCoHX5o/%E3%82%B7%E3%83%BC%E3%83%881';
    let allVideos = [];
    let currentFilteredVideos = [];
    let nowPlayingKey = null;

    window.addEventListener('DOMContentLoaded', () => {
      fetch(sheetJsonUrl)
        .then(response => response.json())
        .then(data => {
          allVideos = data;
          populateFilters(data);
          applyFilters();
        })});

    // ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡
document.getElementById('openFilterModal').addEventListener('click', () => {
  document.getElementById('filterModal').classList.remove('hidden');
});

document.getElementById('closeFilterModal').addEventListener('click', () => {
  document.getElementById('filterModal').classList.add('hidden');
});

document.getElementById('applyFilters').addEventListener('click', () => {
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‹ã‚‰å€¤ã‚’å–å¾—ã—ã¦æœ¬ä½“ã«åæ˜ 
  categoryFilter.value = document.getElementById('modalCategoryFilter').value;
  dateFilter.value = document.getElementById('modalDateFilter').value;
  typeFilter.value = document.getElementById('modalTypeFilter').value;
  roleFilter.value = document.getElementById('modalRoleFilter').value;
searchInput.value = document.getElementById('modalSearchInput').value;
sortOrder.value = document.getElementById('modalSortOrder').value;

  applyFilters();
  document.getElementById('filterModal').classList.add('hidden');
});


  const randomPlayButton = document.getElementById('randomPlayButton');
    randomPlayButton.addEventListener('click', () => {
  const list = currentFilteredVideos?.length ? currentFilteredVideos : allVideos;
  const randomVideo = list[Math.floor(Math.random() * list.length)];
    loadVideo(randomVideo, null);
});


      const categoryFilter = document.getElementById('categoryFilter');
      const dateFilter = document.getElementById('dateFilter');
      const typeFilter = document.getElementById('typeFilter');
      const roleFilter = document.getElementById('roleFilter');
      const searchInput = document.getElementById('searchInput');
      const sortOrder = document.getElementById('sortOrder');
      const resetButton = document.getElementById('resetFilters');
      const videoList = document.getElementById('videoList');
      const videoPlayerTemplate = document.getElementById('videoPlayerTemplate');

      function populateFilters(videos) {
        const sets = {
          category: new Set(),
          date: new Set(),
          type: new Set(),
          role: new Set()
        };

        videos.forEach(v => {
          sets.category.add(v["ã‚«ãƒ†ã‚´ãƒª"]);
          sets.type.add(v["å‹•ç”»ç¨®åˆ¥"]);
          sets.role.add(v["æ‹…å½“åŒºåˆ†"]);

            // å…¬é–‹æœˆï¼ˆä¾‹: 2023/07ï¼‰ã ã‘æŠ½å‡ºã—ã¦è¿½åŠ 
  const rawDate = v["å…¬é–‹æœˆ"];
  if (rawDate && /^\d{4}[-\/]\d{2}/.test(rawDate)) {
    const month = rawDate.slice(0, 7).replace('-', '/'); // "YYYY/MM"
    sets.date.add(month);
  }
        });

        addOptions(categoryFilter, [...sets.category].sort());
        addOptions(dateFilter, [...sets.date].sort());
        addOptions(typeFilter, [...sets.type].sort());
        addOptions(roleFilter, [...sets.role].sort());


// ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã«ã‚‚åŒã˜ãè¿½åŠ 
addOptions(document.getElementById('modalCategoryFilter'), [...sets.category].sort());
addOptions(document.getElementById('modalDateFilter'), [...sets.date].sort());
addOptions(document.getElementById('modalTypeFilter'), [...sets.type].sort());
addOptions(document.getElementById('modalRoleFilter'), [...sets.role].sort());

        // ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ©ãƒ³ãƒ€ãƒ å†ç”Ÿãƒœã‚¿ãƒ³
const mobileRandomPlayButton = document.getElementById('mobileRandomPlayButton');
if (mobileRandomPlayButton) {
  mobileRandomPlayButton.addEventListener('click', () => {
    const list = currentFilteredVideos?.length ? currentFilteredVideos : allVideos;
    const randomVideo = list[Math.floor(Math.random() * list.length)];
    loadVideo(randomVideo, null);
  });
}




        [categoryFilter, dateFilter, typeFilter, roleFilter, searchInput, sortOrder].forEach(el => {
          el.addEventListener('change', applyFilters);
          el.addEventListener('input', applyFilters);
        });

        resetButton.addEventListener('click', () => {
          categoryFilter.value = "";
          dateFilter.value = "";
          typeFilter.value = "";
          roleFilter.value = "";
          searchInput.value = "";
          sortOrder.value = "desc";
          applyFilters();
        });
      }

      function addOptions(select, values) {
        values.forEach(v => {
          if (!v) return;
          const option = document.createElement('option');
          option.value = v;
          option.textContent = v;
          select.appendChild(option);
        });
      }

      function applyFilters() {
        let filtered = allVideos.filter(video => {
          return (!categoryFilter.value || video["ã‚«ãƒ†ã‚´ãƒª"] === categoryFilter.value) &&
                 (!dateFilter.value || video["å…¬é–‹æœˆ"].slice(0, 7).replace('-', '/') === dateFilter.value) &&
                 (!typeFilter.value || video["å‹•ç”»ç¨®åˆ¥"] === typeFilter.value) &&
                 (!roleFilter.value || video["æ‹…å½“åŒºåˆ†"] === roleFilter.value) &&
                 (!searchInput.value ||
                  video["title"].toLowerCase().includes(searchInput.value.toLowerCase()) ||
                  video["artist"].toLowerCase().includes(searchInput.value.toLowerCase()));
        });

filtered.sort((a, b) => {
  if (sortOrder.value === "asc" || sortOrder.value === "desc") {
    const dateA = new Date(a["å…¬é–‹æœˆ"]);
    const dateB = new Date(b["å…¬é–‹æœˆ"]);
    return sortOrder.value === "asc" ? dateA - dateB : dateB - dateA;
  } else if (sortOrder.value === "title") {
    return a["title"].localeCompare(b["title"], 'ja');
  } else if (sortOrder.value === "artist") {
    return a["artist"].localeCompare(b["artist"], 'ja');
  }
});

        renderVideoList(filtered);
        currentFilteredVideos = filtered;
      }

function renderVideoList(videos) {
  videoList.innerHTML = '';

    // ä»¶æ•°è¡¨ç¤ºã‚’æ›´æ–°
  const countElement = document.getElementById('songCount');
  countElement.textContent = `${allVideos.length}æ›²ä¸­ ${videos.length}æ›²è¡¨ç¤ºä¸­`;

  let playingElement = null;

  videos.forEach(video => {
    const item = document.createElement('div');
    item.className = 'p-3 mb-3 bg-blue-100 rounded-lg shadow-md border-2 border-teal-700 space-y-1';

    const key = `${video["videoId"]}__${parseInt(video["start"] || 0)}`;
    if (key === nowPlayingKey) {
      item.classList.add('playing');
      playingElement = item;
    }

    
    // 1è¡Œç›®ï¼šã‚¿ã‚¤ãƒˆãƒ« / ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ
    const topRow = document.createElement('div');
    topRow.className = 'video-item-row';

    const title = document.createElement('a');
    title.href = "#";
    title.className = 'video-title hover:underline';
    title.textContent = video["title"];
    title.onclick = e => {
      e.preventDefault();
      loadVideo(video, item);
    };

    const slash = document.createElement('span');
    slash.textContent = ' / ';

    const artist = document.createElement('span');
    artist.className = 'video-artist';
    artist.textContent = video["artist"];

    topRow.appendChild(title);
    topRow.appendChild(slash);
    topRow.appendChild(artist);

    // 2è¡Œç›®ï¼šè©³ç´°æƒ…å ±
    const metaRow = document.createElement('div');
    metaRow.className = 'video-meta';
   [
  video["ã‚«ãƒ†ã‚´ãƒª"],
  video["å…¬é–‹æœˆ"],
  video["å‹•ç”»ç¨®åˆ¥"],
  video["æ‹…å½“åŒºåˆ†"],
  video["platform"] // â† ã“ã“ã« undefined ãŒã‚ã‚‹ã¨å…¨éƒ¨æ­¢ã¾ã‚‹
].filter(Boolean).forEach(text => {
  const span = document.createElement('span');
  span.textContent = text;
  metaRow.appendChild(span);
});


    item.appendChild(topRow);
    item.appendChild(metaRow);
    videoList.appendChild(item);
  });
  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè¡Œ
  if (playingElement) {
    playingElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}



function loadVideo(video, item) {
  const start = parseInt(video["start"] || '0');
  let videoId = video["videoId"];
  const platform = video["platform"];
  let embedUrl = "";

  if (!videoId) return alert("videoId ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“");

  if (platform.toLowerCase().includes("youtube")) {
    const match = videoId.match(/(?:v=|\/|youtu\.be\/)?([0-9A-Za-z_-]{11})/);
    if (match) videoId = match[1];
    embedUrl = `https://www.youtube.com/embed/${videoId}?start=${start}&autoplay=1&enablejsapi=1`;
  } else if (platform.toLowerCase() === "tiktok") {
    const match = videoId.match(/video\/(\d+)/);
    const tiktokId = match ? match[1] : videoId;
    embedUrl = `https://www.tiktok.com/embed/v2/${tiktokId}`;
  }

  // å›ºå®šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å‹•ç”»ã‚’è¨­å®š
  const fixedPlayer = document.getElementById('fixedPlayer');
  const iframe = document.getElementById('playerIframe');
  iframe.src = embedUrl;
  fixedPlayer.style.display = 'block'; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¡¨ç¤º

  const nowPlayingWrapper = document.getElementById('nowPlayingWrapper');
  //fixedPlayer.style.bottom = `${nowPlayingWrapper.offsetHeight}px`;

  
if (platform.toLowerCase().includes("youtube")) {
  iframe.className = "w-full";
  iframe.style.width = "";
  iframe.style.height = "";

  const wrapper = document.getElementById('videoWrapper');
  const container = document.getElementById('playerContainer');

  wrapper.classList.remove("mr-auto");
  wrapper.classList.add("ml-auto", "mr-auto"); // ä¸­å¤®å¯„ã›ã«æˆ»ã™

  if (container) container.classList.add("mx-auto"); // â† è¦ªã‚‚ä¸­å¤®ã«æˆ»ã™

  playerSizeIndex = 0; // ã‚µã‚¤ã‚ºåˆ‡æ›¿ãƒªã‚»ãƒƒãƒˆ
}

 else if (platform.toLowerCase() === "tiktok") {
  iframe.className =  "w-full max-w-xs h-[45vh] sm:h-[550px] mx-auto";
}

  // å†ç”Ÿä¸­ã®æ›²åã‚’æ›´æ–°
  const nowPlayingTitle = document.getElementById('nowPlayingTitle');
  nowPlayingTitle.textContent = video["title"] + " - " + video["artist"];
  nowPlayingKey = `${video["videoId"]}__${start}`;
  applyFilters(); // â† å†æç”»ã—ã¦ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼†ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åæ˜ 

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ä½ç½®ã‚’èª¿æ•´
  const nowPlaying = document.getElementById('nowPlaying');

  // âœ–ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®å‡¦ç†
  document.getElementById('closePlayerBtn').addEventListener('click', () => {
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’éè¡¨ç¤ºã«ã™ã‚‹
    fixedPlayer.style.display = 'none'; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’éè¡¨ç¤º



    
    // å‹•ç”»ã®å†ç”Ÿã‚’åœæ­¢ã™ã‚‹ï¼ˆYouTubeã®å ´åˆï¼‰
    const iframe = document.getElementById('playerIframe');
    if (platform.toLowerCase().includes("youtube")) {
  iframe.contentWindow?.postMessage(JSON.stringify({
    event: 'command',
    func: 'pauseVideo',
    args: []
  }), '*');
} else {
  iframe.src = "";
}
  }); // ã“ã“ã§ addEventListener ã®é–‰ã˜æ‹¬å¼§
} // ã“ã“ã§ loadVideo é–¢æ•°ã®é–‰ã˜æ‹¬å¼§

  // å¤ã„åŸ‹ã‚è¾¼ã¿ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å‰Šé™¤ï¼ˆå›ºå®šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ã†ã®ã§ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å‰Šé™¤ï¼‰
  document.querySelectorAll('.video-player-container').forEach(el => el.remove());

window.addEventListener('resize', () => {
  const fixedPlayer = document.getElementById('fixedPlayer');
  const nowPlayingWrapper = document.getElementById('nowPlayingWrapper');
  fixedPlayer.style.bottom = `${nowPlayingWrapper.offsetHeight + 8}px`;
});


  document.getElementById('prevVideoBtn').addEventListener('click', () => {
  playAdjacentVideo(-1);
  });

  document.getElementById('nextVideoBtn').addEventListener('click', () => {
  playAdjacentVideo(1);
  });

    document.getElementById('randomFromFilteredBtn').addEventListener('click', () => {
  const list = currentFilteredVideos?.length ? currentFilteredVideos : allVideos;
  const randomVideo = list[Math.floor(Math.random() * list.length)];
  loadVideo(randomVideo, null);
});

function playAdjacentVideo(direction) {
  if (!currentFilteredVideos.length) return;

  const currentIndex = currentFilteredVideos.findIndex(v =>
    `${v.videoId}__${v.start || 0}` === nowPlayingKey
    );

  const newIndex = currentIndex + direction;
  if (newIndex >= 0 && newIndex < currentFilteredVideos.length) {
    loadVideo(currentFilteredVideos[newIndex], null);
    }
    }

let playerSizeIndex = 0;
const playerSizes = [
  "full", // åˆæœŸï¼šå¹…ã„ã£ã±ã„ï¼ˆä¸­å¤®å¯„ã›ï¼‰
  { width: "960px", height: "540px" }, // ä¸­ï¼šå·¦å¯„ã›
  { width: "640px", height: "360px" }  // å°ï¼šå·¦å¯„ã›
];

function togglePlayerSize() {
  const iframe = document.getElementById('playerIframe');
  const wrapper = document.getElementById('videoWrapper');
  const container = document.getElementById('playerContainer');
  if (!iframe || !wrapper || !container) return;

  if (playerSizeIndex === 0) {
    // åˆæœŸçŠ¶æ…‹ â†’ ä¸­ã‚µã‚¤ã‚ºï¼ˆå·¦å¯„ã›ï¼‰
    iframe.className = ""; // w-full è§£é™¤
    iframe.style.width = playerSizes[1].width;
    iframe.style.height = playerSizes[1].height;

    wrapper.classList.remove("ml-auto", "mr-auto");
    wrapper.classList.add("mr-auto");

    container.classList.remove("mx-auto");
  } else {
    const size = playerSizes[playerSizeIndex];
    iframe.style.width = size.width;
    iframe.style.height = size.height;
  }

  playerSizeIndex = (playerSizeIndex + 1) % playerSizes.length;
}



  </script>
</body>
</html>
